#!/bin/bash

rm /viridian/etc/hosts &> /dev/null
touch /viridian/etc/hosts &> /dev/null

hosts=$(python getstatus.py | tr ',' '\n' | sed "s/^ //g; s/{//g; s/}//g; s/\[//g; s/\]//g; s/^u//g; s/\: u/\: /g; s/\: / \: /g; s/'//g; s/^status/\\nstatus/g; /servers \: status \:/d; /organization_name/d; /otp_secret/d; /name \: zomp/d; /real_address/d; /connected_since/d; /device_name/d; /platform/d; /client_id/d; /id/d; /disabled/d; /email/d; /otp_auth/d; /organization/d; /type/d" | tac | sed '1,3{d}' | tac | sed '1d' | tr '\n' ' ' | sed 's/status \: //g; s/name \: //g; s/virt_address \: //g' | sed "s/  /\\n/g; \$a\n" | sed 's/^False //; s/^True //; s/\(.*\) \(.*\)/\2 \1/g; $ d')

printf "$hosts\n" | while read line
do
	echo $line >> /viridian/etc/hosts
	echo Added $(echo $line | cut -d' ' -f2) at $(echo $line | cut -d' ' -f1)
done

echo "10.10.11.1 zomp" >> /viridian/etc/hosts
echo Added zomp at 10.10.11.1
