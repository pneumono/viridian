#!/bin/bash

list=$(netstat -Wtulpn | sed '1,2d; s/::1:/127.0.0.1:/g; s/::/0.0.0.0/g; s/  */ /g; s/LISTEN //g; s/tcp 0 0/tcp/g; s/udp 0 0/udp/g; s/tcp6 0 0/tcp/g; s/udp6 0 0/udp/g; s/0\.0\.0\.0\:\*//g; s/\(^...\) \([0-9]*\.[0-9]*\.[0-9]*\.[0-9]*\)\:\([0-9]*\) \(.*$\)/\3 \1 \2 \4/g; s/  */ /g' | sort -gu)

printf "$list" | while read line
do
        port=$(printf "$line" | cut -d' ' -f1)
        proto=$(printf "$line" | cut -d' ' -f2)
        interface=$(printf "$line" | cut -d' ' -f3)
        process=$(printf "$line" | cut -d' ' -f4)
        if [[ "$proto" == "udp" ]]; then
                proto="\e[1;33m$proto\e[0m"
        elif [[ "$proto" == "tcp" ]]; then
                proto="\e[1;34m$proto\e[0m"
        fi
        if [[ "$interface" == "0.0.0.0" ]]; then
                interface="\e[0;41m$interface\e[0m"
	elif [[ "$interface" == "127.0.0.1" ]]; then
		interface="\e[0;44m$interface\e[0m"
	else
		interface="\e[0;45m$interface\e[0m"
        fi
        printf "$port/$proto $interface $process\n"
done | column -t
